{% extends "layout.html" %}

{% block content %}
<div class="container mt-5">

  {% if session.user %}
    <!-- Welcome Section -->
    <div class="text-center mb-4">
      <h2>üîê Welcome, {{ session.user }}</h2>
      <p>Upload your files securely and share via token or QR.</p>
    </div>

    {% if session.user == 'admin' %}
    <div class="mb-3">
      <a href="/admin" class="btn btn-outline-dark">‚öôÔ∏è Go to Admin Dashboard</a>
    </div>
    {% endif %}

    <!-- Upload Form -->
    <form method="post" action="/upload" enctype="multipart/form-data" class="mb-4">
      <div class="input-group">
        <input type="file" name="file" class="form-control" required>
        <button type="submit" class="btn btn-success">Upload</button>
      </div>
    </form>

    <!-- Uploaded Files -->
    <h4>Your Uploaded Files</h4>
    {% if files %}
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <th>Filename</th>
          <th>Token</th>
          <th>QR Code</th>
        </tr>
      </thead>
      <tbody>
        {% for filename, token in files %}
        <tr>
          <td>{{ filename }}</td>
          <td>{{ token }}</td>
          <td><img src="/qr/{{ token }}" alt="QR Code" width="100"></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="text-muted">No files uploaded yet.</p>
    {% endif %}

    <!-- Download By Token -->
    <hr>
    <h5>Download File by Token</h5>
    <form method="post" action="/download">
      <div class="input-group">
        <input type="text" name="token" class="form-control" placeholder="Enter token..." required>
        <button type="submit" class="btn btn-primary">Download</button>
      </div>
    </form>

    <!-- Admin Logs (Only for Admin) -->
    {% if session.user == 'admin' and logs %}
    <hr>
    <h4 class="mt-4">‚¨áÔ∏è Download Logs for Your Files</h4>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Filename</th>
          <th>Downloaded By</th>
          <th>Timestamp</th>
        </tr>
      </thead>
      <tbody>
        {% for filename, user, time in logs %}
        <tr>
          <td>{{ filename }}</td>
          <td>{{ user }}</td>
          <td>{{ time }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endif %}

  {% else %}
    <!-- Guest View -->
    <div class="text-center">
      <h2>üîê Welcome to Secure File Sharing App</h2>
      <p>Please <a href="/login">login</a> or <a href="/register">register</a> to continue.</p>
    </div>
  {% endif %}

</div>
{% endblock %}
